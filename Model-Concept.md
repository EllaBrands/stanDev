## C++ concept

The C++ model generated by translating a Stan model implements the following C++ "concept".  Functions working with models must take the model's class as a template parameter.  The base class that existed before Stan 2.0 has been eliminated.

```
class M {
public:

  // read data from context, errors/warnings to msgs
  // throws exceptions if errors
  M(stan::io::var_context& data_context,
    std::ostream* msgs = 0);

  ~M();

  // transformed constrained inits to unconstrained vectors
  // throws exceptions if errors
  void transform_inits(const stan::io::var_context& inits_context,
                       std::vector<int>& params_i__,
                       std::vector<double>& params_r__) const;

  // log prob function for unconstrained parameters, with or without Jacobian
  // and computed with or without proportionality;  error msgs to msgs
  template <typename T, bool propto, bool jacobian_adjust_transforms>
  T log_prob(std::vector<T>& params_r,
             std::vector<int>& params_i,
             std::ostream* msgs = 0) const;

  // write constrained param names, just as names w/o dimensions
  void get_param_names(std::vector<std::string>& names) const;

  // write out dimensions of params corresponding to get_param_names
  void get_dims(std::vector<std::vector<size_t> >& dimss__) const;

  // write parameters into specified output vector var in constrained form
  // generate anything in generated quantities block using RNG
  template <typename RNG>
  void write_array(RNG& base_rng__,
                   std::vector<double>& params_r,
                   std::vector<int>& params_i,
                   std::vector<double>& vars,
                   bool include_transformed_param = true,
                   bool include_generated_quantities = true,
                   std::ostream* out = 0) const;

  // ?? writes just the parameters into the output stream, using dummy rng
  void write_array_params(std::vector<double>& params_r,
                          std::vector<int>& params_i,
                          std::vector<double>& vars,
                          std::ostream* out = 0) const;

  // ?? writes parameters, transformed params, generated quants into the output stream, using dummy
  void write_array_params_all(std::vector<double>& params_r,
                              std::vector<int>& params_i,
                              std::vector<double>& vars,
                              std::ostream* out = 0) const;

  // writes CSV output header with encoded parameter, trans param, gen quants
  void write_csv_header(std::ostream& o__) const;

  // write values in a line of CSV format using specified RNG, 
  // includes params, transformed params, and gen quants
  template <typename RNG>
  void write_csv(RNG& base_rng__,
                 std::vector<double>& params_r__,
                 std::vector<int>& params_i__,
                 std::ostream& o__,
                 std::ostream* pstream__ = 0) const;

  // returns name of model
  static std::string model_name();

  // write constrained params with dimensions encoded, 
  // optionally included transformed params, gen quants
  void constrained_param_names(std::vector<std::string>& param_names,
                               bool include_tparams = true,
                               bool include_gqs = true) const;

  // write unconstrained params with dimensions encoded,
  // indexing based on transform
  void unconstrained_param_names(std::vector<std::string>& param_names__,
                                 bool include_tparams__ = true,
                                 bool include_gqs__ = true) const;

  // return the number of unconstrained real parameters
  size_t num_params_r() const;

  // return the number of integer parameters
  size_t num_params_i() const;

  // return ranges of integer parameter with specified index
  const pair<int,int>& param_range_i(size_t idx) const;
}
```

## Utility functions

Replace the eliminated base class functions and some of the generated functions by static model utility functions.

#### Gradient: Log probability and gradient

```
template <class M, bool propto, bool jacobian_adjust_transform>
double 
log_prob_gradient(const M& model,
                  vector<double>& params_r, vector<int>& params_i,
                  vector<double>& gradient,
                  ostream* msgs = 0);
```

#### Hessians: Log probability, gradient, and Hessian

```
template <class M, bool propto, bool jacobian_adjust_transform>
double 
log_prob_hessian(const M& model,
                 vector<double>& params_r, vector<int>& params_i,
                 vector<double>& gradient,
                 vector<double>& hessian,
                 ostream* msgs = 0);
```